create table profiles (
  id uuid references auth.users on delete cascade,
  role text check (role in ('user','technician','admin')) not null,
  first_name text,
  middle_name text,
  last_name text,
  phone text unique,
  email text unique,
  profile_photo text,
  created_at timestamp default now(),
  primary key (id)
);


create table technician_details (
  id uuid references profiles(id) on delete cascade,
  aadhaar_pan_url text,
  experience_years int,
  promo_code text,
  is_verified boolean default false,
  primary key (id)
);


create table admins (
  id uuid references profiles(id) on delete cascade,
  created_by uuid,
  created_at timestamp default now(),
  primary key (id)
);


STEP 5: Enable Row Level Security (HIGH SECURITY)

alter table profiles enable row level security;
alter table technician_details enable row level security;
alter table admins enable row level security;

STEP 6: Add RLS Policies


Profiles (User can read own data)

create policy "Read own profile"
on profiles for select
using (auth.uid() = id);


Technician details

create policy "Tech read own data"
on technician_details for select
using (auth.uid() = id);







=========================== Services Table Created ================================ 


create table services (
  id uuid default gen_random_uuid() primary key,

  title text not null,
  service_code text unique not null,
  category text not null,

  price numeric not null,
  pricing_type text default 'fixed',

  description text,
  image_url text,

  is_active boolean default true,

  created_at timestamptz default now(),
  updated_at timestamptz default now()
);



============================================  Products ==========================================

create table products (
  id uuid primary key default gen_random_uuid(),
  title text not null,
  description text,
  specifications jsonb,
  price numeric not null,
  discount_price numeric,
  rating numeric default 0,
  reviews_count int default 0,
  in_stock boolean default true,

  main_image text,
  thumbnail_image text,
  gallery_images text[],
  catalog_pdf text,

  created_at timestamp default now(),
  updated_at timestamp default now()
);

alter table products disable row level security;
